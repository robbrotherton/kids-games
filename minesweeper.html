<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Desert Explorer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #f4e2c4;
      /* desert backdrop */
    }

    #header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 100%;
      max-height: 30px;
      padding: 10px;
      background-color: #d2b48c;
      /* sand color */
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    #header img {
      width: 1.5em;
    }
    #back-button, #settings-button {
    background: none;
    border: none;
    font-size: 18px;
    cursor: pointer;
  }
  #game-title {
    font-size: 24px;
    text-align: center;
    flex-grow: 1;
  }

    #game {

      justify-content: center;
      display: grid;
      grid-template-columns: repeat(10, 40px);
      grid-gap: 3px;
      margin-top: 20px;
    }

    .cell {
      width: 40px;
      height: 40px;
      display: flex;
      justify-content: center;
      align-items: center;
      border: 1px solid #e3c98c;
      background-color: #f9e8c7;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      perspective: 500px;
    }

    .cell.revealed {
      cursor: default;
    }

    .cell-content {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: #d2b48c;
      /* sand color */
      transform-style: preserve-3d;
      transition: transform 0.4s ease;
      position: relative;
    }

    .cell.revealed .cell-content {
      transform: rotateY(180deg);
    }

    .cell-front,
    .cell-back {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .cell-front {
      background-color: #f9e8c7;
      /* lighter sand */
    }

    .cell-back {
      transform: rotateY(180deg);
      background-color: #e3c98c;
      /* sand */
      color: #4a4a4a;
      /* default number color */
    }

    .cell.mine .cell-back {
      background-color: rgb(221, 81, 30);
      /* deeper sand */
      color: #2e8b57;
      /* cactus green */
      font-size: 2.5em;
    }

    .cell-back.oasis {
      background-color: #80bed4;
      /* oasis blue */
    }
  </style>
</head>

<body>
  <div id="header">
    <button id="back-button" title="Go back" onclick="window.location.href='index.html'"><img src="assets/back-arrow.png" alt="Back"></button>
    <h1 id="game-title">Desert Explorer</h1>
    <button id="settings-button" onclick="openSettings()"><img src="assets/settings-gear.png" alt="Settings"></button>
  </div>
  <div id="game"></div>

  <script>
    const width = 10;
    const height = 10;
    const numMines = 20;

    const game = document.getElementById("game");
    const grid = [];
    const mines = new Set();

    function init() {
      // create the grid
      for (let y = 0; y < height; y++) {
        grid[y] = [];
        for (let x = 0; x < width; x++) {
          const cell = document.createElement("div");
          cell.className = "cell";
          cell.dataset.x = x;
          cell.dataset.y = y;

          const cellContent = document.createElement("div");
          cellContent.className = "cell-content";

          const front = document.createElement("div");
          front.className = "cell-front";

          const back = document.createElement("div");
          back.className = "cell-back";

          cellContent.appendChild(front);
          cellContent.appendChild(back);
          cell.appendChild(cellContent);

          game.appendChild(cell);

          grid[y][x] = { cell, mine: false, revealed: false, delay: 0 };
          cell.addEventListener("click", () => reveal(x, y, 0));
        }
      }

      // place mines
      while (mines.size < numMines) {
        const x = Math.floor(Math.random() * width);
        const y = Math.floor(Math.random() * height);
        const key = `${x},${y}`;
        if (!mines.has(key)) {
          mines.add(key);
          grid[y][x].mine = true;
        }
      }
    }

    function countMines(x, y) {
      let count = 0;
      for (let dx = -1; dx <= 1; dx++) {
        for (let dy = -1; dy <= 1; dy++) {
          const nx = x + dx;
          const ny = y + dy;
          if (
            nx >= 0 &&
            ny >= 0 &&
            nx < width &&
            ny < height &&
            grid[ny][nx].mine
          ) {
            count++;
          }
        }
      }
      return count;
    }

    function reveal(x, y, delay) {
      if (x < 0 || y < 0 || x >= width || y >= height) return;
      const cellData = grid[y][x];
      if (cellData.revealed) return;

      cellData.revealed = true;
      cellData.delay = delay;
      setTimeout(() => {
        cellData.cell.classList.add("revealed");
        const back = cellData.cell.querySelector(".cell-back");

        if (cellData.mine) {
          cellData.cell.classList.add("mine");
          back.textContent = "ðŸŒµ"; // cactus emoji
          if (delay === 0) alert("you hit a cactus!");
          return;
        }

        const mineCount = countMines(x, y);
        if (mineCount > 0) {
          back.textContent = mineCount;
        } else {
          // mark as an oasis
          back.classList.add("oasis");
          // back.textContent = "ðŸ’§"; // oasis drop
          // recursively reveal neighbors with increasing delay
          for (let dx = -1; dx <= 1; dx++) {
            for (let dy = -1; dy <= 1; dy++) {
              if (dx !== 0 || dy !== 0) {
                reveal(x + dx, y + dy, delay + 20);
              }
            }
          }
        }
      }, delay);
    }

    init();
  </script>
</body>

</html>